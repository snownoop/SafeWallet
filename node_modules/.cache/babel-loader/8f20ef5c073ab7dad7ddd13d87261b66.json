{"ast":null,"code":"var _jsxFileName = \"/Users/Raid/Mastering_Ethereum/DevelopingFirstDapp/SafeWallet/src/erc20/ModalERCWithdrawLimit.js\";\nimport React, { Component } from 'react';\nimport ReactDOM from 'react-dom';\nimport { ReceiptComponent, InitialTxHashComponent } from '../sharedComponents/sharedComponents.js';\nimport '../Modal.css';\n\nvar Tx = require('ethereumjs-tx').Transaction;\n\nvar EthCrypto = require(\"eth-crypto\");\n\nconst ModalTrigger = ({\n  handleSubmit,\n  handleInputChange,\n  errors\n}) => React.createElement(\"form\", {\n  id: \"WithdrawLimitERC\",\n  onSubmit: handleSubmit,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 9\n  },\n  __self: this\n}, React.createElement(\"input\", {\n  type: \"text\",\n  name: \"privateKey\",\n  onChange: handleInputChange,\n  className: \"smartInput2\",\n  placeholder: \"Private Key\",\n  required: true,\n  minLength: \"64\",\n  maxLength: \"64\",\n  pattern: \"\\\\w+\",\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 10\n  },\n  __self: this\n}), React.createElement(\"input\", {\n  type: \"text\",\n  name: \"safetyPrivateKey\",\n  onChange: handleInputChange,\n  className: \"smartInput2\",\n  placeholder: \"Safety Key\",\n  required: true,\n  minLength: \"64\",\n  maxLength: \"64\",\n  pattern: \"\\\\w+\",\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 12\n  },\n  __self: this\n}), React.createElement(\"button\", {\n  type: \"submit\",\n  className: \"smartButton\",\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 14\n  },\n  __self: this\n}, \"withdraw limit\"));\n\nconst ModalContent = ({\n  closeModal,\n  modalRef,\n  onKeyDown,\n  onClickAway,\n  children\n}) => {\n  return ReactDOM.createPortal(React.createElement(\"aside\", {\n    className: \"c-modal-cover\",\n    onKeyDown: onKeyDown,\n    onClick: onClickAway,\n    tabIndex: \"0\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 18\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"c-modal-safety\",\n    ref: modalRef,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 19\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    className: \"c-modal__close\",\n    onClick: closeModal,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 20\n    },\n    __self: this\n  }, React.createElement(\"svg\", {\n    className: \"c-modal__close-icon\",\n    viewBox: \"0 0 40 40\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 21\n    },\n    __self: this\n  }, React.createElement(\"path\", {\n    d: \"M 10,10 L 30,30 M 30,10 L 10,30\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 21\n    },\n    __self: this\n  }))), React.createElement(\"div\", {\n    className: \"c-modal__body\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 23\n    },\n    __self: this\n  }, children))), document.body);\n};\n\nclass ModalERCWithdrawLimit extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.handleInputChange = event => {\n      event.preventDefault();\n      const _event$target = event.target,\n            name = _event$target.name,\n            value = _event$target.value;\n\n      switch (name) {\n        case 'safetyPrivateKey':\n        case 'privateKey':\n          if (event.target.validity.tooShort) {\n            event.target.setCustomValidity(\"Private key has to be 64 characters\");\n          } else if (event.target.validity.patternMismatch) {\n            event.target.setCustomValidity(\"Only alphanumeric characters are allowed\");\n          } else {\n            event.target.setCustomValidity(\"\");\n          }\n\n          break;\n\n        default:\n          break;\n      }\n\n      this.setState({\n        [name]: value\n      });\n    };\n\n    this.handleSubmit = event => {\n      event.preventDefault();\n      this.withdrawLimit(this.state.privateKey, this.state.safetyPrivateKey);\n      document.getElementById(\"WithdrawLimitERC\").reset();\n    };\n\n    this.openModal = () => {\n      this.setState({\n        isOpen: true\n      });\n    };\n\n    this.closeModal = () => {\n      this.setState({\n        isOpen: false\n      });\n    };\n\n    this.onKeyDown = event => {\n      return event.keyCode === 27 && this.closeModal();\n    };\n\n    this.onClickAway = event => {\n      if (this.modalNode && this.modalNode.contains(event.target)) return;\n      this.closeModal();\n    };\n\n    this.withdrawLimit = (privateKey, safetyPrivateKey) => {\n      let web3 = this.props.web3;\n      let multisigERC20Token = this.props.multisigERC20Token;\n      let multisigERC20Address = this.props.multisigERC20Address;\n      let modal = this;\n      let tokenSymbol = this.props.tokenSymbol;\n      let addrFrom = this.props.address;\n      const priv = Buffer.from(privateKey, 'hex');\n      web3.eth.getTransactionCount(this.props.address, (err, txCount) => {\n        multisigERC20Token.methods.transactionNonces(addrFrom).call({\n          from: addrFrom\n        }, (error, nonce) => {\n          if (error) {\n            console.log(error);\n          } else {\n            // Build the transaction\n            web3.eth.getGasPrice().then(gasPrice => {\n              let msg = [{\n                type: \"address\",\n                value: addrFrom\n              }, {\n                type: \"bytes32\",\n                value: tokenSymbol\n              }, {\n                type: \"uint256\",\n                value: nonce.toString()\n              }];\n              console.log(msg);\n\n              const _message = EthCrypto.hash.keccak256(msg);\n\n              console.log(\"message: \".concat(_message));\n\n              const _signature = EthCrypto.sign(safetyPrivateKey, _message);\n\n              console.log(\"signature: \".concat(_signature));\n              multisigERC20Token.methods.withdrawLimit(tokenSymbol, _signature).estimateGas({\n                gas: gasPrice,\n                from: addrFrom\n              }, function (error, gasAmount) {\n                console.log('Current gas price: ', gasPrice);\n                console.log('Estimate of gas usage: ', gasAmount);\n                const txObject = {\n                  nonce: web3.utils.toHex(txCount),\n                  gasLimit: web3.utils.toHex(gasAmount),\n                  gasPrice: web3.utils.toHex(gasPrice),\n                  to: multisigERC20Address,\n                  data: multisigERC20Token.methods.withdrawLimit(tokenSymbol, _signature).encodeABI()\n                };\n                console.log(txObject); // Sign the transaction\n\n                const tx = new Tx(txObject, {\n                  chain: 'ropsten',\n                  hardfork: 'petersburg'\n                });\n                tx.sign(priv);\n                const serializedTransaction = tx.serialize();\n                const rawTx = '0x' + serializedTransaction.toString('hex');\n                console.log(rawTx); // Broadcast the transaction\n\n                web3.eth.sendSignedTransaction(rawTx).once('transactionHash', function (hash) {\n                  console.log('Hash of transaction: ', hash);\n                  modal.setState({\n                    txHash: hash,\n                    hashReceipt: true,\n                    confirmationReceipt: false\n                  });\n                  modal.openModal();\n                }).once('confirmation', function (confNumber, receipt) {\n                  console.log('Transaction confirmation number: ', confNumber);\n                  console.log('Transaction receipt: ', receipt);\n                  modal.setState({\n                    txReceipt: receipt,\n                    confirmationReceipt: true,\n                    hashReceipt: false\n                  });\n                  modal.openModal();\n                }).on('error', function (error) {\n                  console.log(error);\n                });\n              });\n            });\n          }\n        });\n      });\n    };\n\n    this.state = {\n      txHash: '',\n      txReceipt: '',\n      safetyPrivateKey: '',\n      privateKey: '',\n      isOpen: false,\n      hashReceipt: false,\n      confirmationReceipt: false\n    };\n  }\n\n  render() {\n    return React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180\n      },\n      __self: this\n    }, React.createElement(ModalTrigger, {\n      handleSubmit: this.handleSubmit,\n      handleInputChange: this.handleInputChange,\n      errors: this.state.errors,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181\n      },\n      __self: this\n    }), this.state.isOpen && React.createElement(ModalContent, {\n      closeModal: this.closeModal,\n      onKeyDown: this.onKeyDown,\n      onClickAway: this.onClickAway,\n      modalRef: n => this.modalNode = n,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187\n      },\n      __self: this\n    }, this.state.hashReceipt ? React.createElement(InitialTxHashComponent, {\n      transactionHash: this.state.txHash,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193\n      },\n      __self: this\n    }) : null, this.state.confirmationReceipt ? React.createElement(ReceiptComponent, {\n      transactionHash: this.state.txReceipt.transactionHash,\n      blockHash: this.state.txReceipt.blockHash,\n      blockNumber: this.state.txReceipt.blockNumber,\n      gasUsed: this.state.txReceipt.gasUsed,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196\n      },\n      __self: this\n    }) : null));\n  }\n\n}\n\nexport default ModalERCWithdrawLimit;","map":{"version":3,"sources":["/Users/Raid/Mastering_Ethereum/DevelopingFirstDapp/SafeWallet/src/erc20/ModalERCWithdrawLimit.js"],"names":["React","Component","ReactDOM","ReceiptComponent","InitialTxHashComponent","Tx","require","Transaction","EthCrypto","ModalTrigger","handleSubmit","handleInputChange","errors","ModalContent","closeModal","modalRef","onKeyDown","onClickAway","children","createPortal","document","body","ModalERCWithdrawLimit","constructor","props","event","preventDefault","target","name","value","validity","tooShort","setCustomValidity","patternMismatch","setState","withdrawLimit","state","privateKey","safetyPrivateKey","getElementById","reset","openModal","isOpen","keyCode","modalNode","contains","web3","multisigERC20Token","multisigERC20Address","modal","tokenSymbol","addrFrom","address","priv","Buffer","from","eth","getTransactionCount","err","txCount","methods","transactionNonces","call","error","nonce","console","log","getGasPrice","then","gasPrice","msg","type","toString","_message","hash","keccak256","_signature","sign","estimateGas","gas","gasAmount","txObject","utils","toHex","gasLimit","to","data","encodeABI","tx","chain","hardfork","serializedTransaction","serialize","rawTx","sendSignedTransaction","once","txHash","hashReceipt","confirmationReceipt","confNumber","receipt","txReceipt","on","render","n","transactionHash","blockHash","blockNumber","gasUsed"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport ReactDOM from 'react-dom';\nimport {ReceiptComponent, InitialTxHashComponent} from '../sharedComponents/sharedComponents.js';\nimport '../Modal.css';\nvar Tx = require('ethereumjs-tx').Transaction;\nvar EthCrypto = require(\"eth-crypto\");\n\nconst ModalTrigger = ({handleSubmit, handleInputChange, errors}) => \n        <form id=\"WithdrawLimitERC\" onSubmit={handleSubmit}>\n          <input type=\"text\" name=\"privateKey\" onChange={handleInputChange} className=\"smartInput2\" placeholder=\"Private Key\"\n            required minLength=\"64\" maxLength=\"64\" pattern=\"\\w+\"/>\n          <input type=\"text\" name=\"safetyPrivateKey\" onChange={handleInputChange} className=\"smartInput2\" placeholder=\"Safety Key\"\n            required minLength=\"64\" maxLength=\"64\" pattern=\"\\w+\"/>\n          <button type=\"submit\" className=\"smartButton\">withdraw limit</button>\n        </form>;\nconst ModalContent = ({closeModal, modalRef, onKeyDown, onClickAway, children}) => {\n\treturn ReactDOM.createPortal(\n\t\t<aside className=\"c-modal-cover\" onKeyDown={onKeyDown} onClick={onClickAway} tabIndex=\"0\">\n\t\t  <div className=\"c-modal-safety\" ref={modalRef}>\n\t\t    <button className=\"c-modal__close\" onClick={closeModal}>\n\t\t      <svg className=\"c-modal__close-icon\" viewBox=\"0 0 40 40\"><path d=\"M 10,10 L 30,30 M 30,10 L 10,30\"></path></svg>\n\t\t    </button>\n\t\t    <div className=\"c-modal__body\">\n\t\t      {children}\n\t\t    </div>\n\t\t </div>\n\t\t</aside>,\n\t\tdocument.body\n\t);\n};\n\nclass ModalERCWithdrawLimit extends React.Component {\n\n  constructor(props) {\n  \tsuper(props);\n  \tthis.state = {\n      txHash: '',\n      txReceipt: '',\n      safetyPrivateKey: '',\n      privateKey: '',\n  \t\tisOpen: false,\n      hashReceipt: false,\n      confirmationReceipt:false\n      }\n  }\n\n  handleInputChange = (event) => {\n    event.preventDefault();\n    const { name, value } = event.target;\n\n    switch (name) {\n    case 'safetyPrivateKey':\n    case 'privateKey':\n      if (event.target.validity.tooShort) {\n        event.target.setCustomValidity(\"Private key has to be 64 characters\");\n      } else if (event.target.validity.patternMismatch) {\n        event.target.setCustomValidity(\"Only alphanumeric characters are allowed\");\n      } else {\n        event.target.setCustomValidity(\"\");\n      }\n      break;\n    default:\n      break;\n    }\n\n    this.setState({ [name]: value });\n  }\n\n  handleSubmit = (event) => {\n    event.preventDefault();\n    this.withdrawLimit(this.state.privateKey, this.state.safetyPrivateKey);\n    document.getElementById(\"WithdrawLimitERC\").reset();\n  }\n  \n  openModal = () => {\n\tthis.setState({ \n\t\tisOpen: true, \n\t  });\n  };\n\n  closeModal = () => {\n  this.setState({ \n    isOpen: false, \n    });\n  };\n\n  onKeyDown = (event) => {\n\treturn event.keyCode === 27 && this.closeModal();\n  }\n  \n  onClickAway = (event) => {\n\t  if (this.modalNode && this.modalNode.contains(event.target)) return;\n\t  this.closeModal();\n\t};\n\n  withdrawLimit = (privateKey, safetyPrivateKey) => {\n    let web3 = this.props.web3;\n    let multisigERC20Token = this.props.multisigERC20Token;\n    let multisigERC20Address = this.props.multisigERC20Address;\n    let modal = this;\n    let tokenSymbol = this.props.tokenSymbol;\n    let addrFrom = this.props.address;\n    const priv = Buffer.from(privateKey, 'hex');\n\n    web3.eth.getTransactionCount(this.props.address, (err, txCount) => {\n        multisigERC20Token.methods.transactionNonces(addrFrom).call({from: addrFrom}, (error, nonce) => {\n            if (error) {\n                console.log(error)\n            } else {\n            // Build the transaction\n            web3.eth.getGasPrice().then((gasPrice) => {\n            \n            let msg = [\n              { type: \"address\", value: addrFrom},\n              { type: \"bytes32\", value: tokenSymbol},\n              { type: \"uint256\", value: nonce.toString()}\n            ];\n\n            console.log(msg);\n            const _message = EthCrypto.hash.keccak256(msg); \n            console.log(`message: ${_message}`);\n            \n            const _signature = EthCrypto.sign(safetyPrivateKey, _message);\n\n            console.log(`signature: ${_signature}`);\n            multisigERC20Token.methods.withdrawLimit(tokenSymbol, _signature).estimateGas({gas: gasPrice, from: addrFrom}, function(error, gasAmount) {\n                console.log('Current gas price: ', gasPrice);\n                console.log('Estimate of gas usage: ', gasAmount);\n                const txObject = {\n                    nonce: web3.utils.toHex(txCount),\n                    gasLimit: web3.utils.toHex(gasAmount), \n                    gasPrice: web3.utils.toHex(gasPrice), \n                    to: multisigERC20Address,\n                    data: multisigERC20Token.methods.withdrawLimit(tokenSymbol, _signature).encodeABI()\n                };\n                console.log(txObject);\n\n                // Sign the transaction\n                const tx = new Tx(txObject, { chain: 'ropsten', hardfork: 'petersburg' });\n                tx.sign(priv);\n\n                const serializedTransaction = tx.serialize();\n                const rawTx = '0x' + serializedTransaction.toString('hex');\n                \n                console.log(rawTx);\n\n                // Broadcast the transaction\n                web3.eth.sendSignedTransaction(rawTx)\n                .once('transactionHash', function(hash){ \n                    console.log('Hash of transaction: ', hash)\n                    modal.setState({ \n                      txHash: hash,\n                      hashReceipt: true,\n                      confirmationReceipt: false                       \n                    });\n                    modal.openModal();\n                })\n                .once('confirmation', function(confNumber, receipt){ \n                    console.log('Transaction confirmation number: ', confNumber) \n                    console.log('Transaction receipt: ', receipt)\n                    \n                    modal.setState({ \n                      txReceipt: receipt,\n                      confirmationReceipt: true, \n                      hashReceipt: false\n                    });\n                    modal.openModal(); \n                })\n                .on('error', function(error){ console.log(error) });\n            })\n          })\n        }\n      })\n    })\n  } \n\n  render() {\n\n  \treturn (\n      <span>\n       <ModalTrigger \n        handleSubmit={this.handleSubmit} \n        handleInputChange={this.handleInputChange}\n        errors={this.state.errors}/>\n       {\n       \tthis.state.isOpen && \n       \t<ModalContent \n       \t\tcloseModal={this.closeModal} \n       \t\tonKeyDown={this.onKeyDown}\n       \t\tonClickAway={this.onClickAway}\n       \t\tmodalRef={n => this.modalNode = n}> \n       \t\t{this.state.hashReceipt ? \n            <InitialTxHashComponent transactionHash={this.state.txHash} />\n            : null} \n          {this.state.confirmationReceipt ?\n            <ReceiptComponent\n              transactionHash={this.state.txReceipt.transactionHash}\n              blockHash={this.state.txReceipt.blockHash}\n              blockNumber={this.state.txReceipt.blockNumber}\n              gasUsed={this.state.txReceipt.gasUsed}/>\n            : null} \n          \n       \t</ModalContent>\n       }\n      </span>\n    );\n  }\n}\n\nexport default ModalERCWithdrawLimit;"]},"metadata":{},"sourceType":"module"}